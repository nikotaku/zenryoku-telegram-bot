#!/usr/bin/env python3
"""
SEOè¨˜äº‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”Ÿæˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ1: ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç´¹ä»‹é¢¨è¨˜äº‹
ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ2: ãŠæ‚©ã¿è§£æ±ºå‹ãƒã‚¦ãƒ„ãƒ¼è¨˜äº‹

OpenAI APIã‚’ä½¿ç”¨ã—ã¦ã€å…¨åŠ›ã‚¨ã‚¹ãƒ†ã®æƒ…å ±ã‚’åŸ‹ã‚è¾¼ã‚“ã è¨˜äº‹ãƒ‰ãƒ©ãƒ•ãƒˆã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹ã€‚
"""

import os
import logging

logger = logging.getLogger(__name__)

# â”€â”€â”€ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå®šç¾© â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

TEMPLATE_1_INFO = {
    "id": "ranking",
    "title": "ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ1ï¼šãƒ©ãƒ³ã‚­ãƒ³ã‚°ç´¹ä»‹é¢¨è¨˜äº‹",
    "emoji": "ğŸ†",
    "description": (
        "ã€Œä»™å° ãƒ¡ãƒ³ã‚ºã‚¨ã‚¹ãƒ† ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã€ãªã©ã®æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§ä¸Šä½è¡¨ç¤ºã‚’ç‹™ã†è¨˜äº‹ã€‚\n"
        "å…¨åŠ›ã‚¨ã‚¹ãƒ†ãŒã‚¨ãƒªã‚¢No.1ã§ã‚ã‚‹ã“ã¨ã‚’ã‚¢ãƒ”ãƒ¼ãƒ«ã—ã¾ã™ã€‚"
    ),
    "title_examples": [
        "ã€2026å¹´æœ€æ–°ã€‘ä»™å°ã®ãƒ¡ãƒ³ã‚ºã‚¨ã‚¹ãƒ†äººæ°—ãƒ©ãƒ³ã‚­ãƒ³ã‚°TOP5ï¼å…¨åŠ›ã‚¨ã‚¹ãƒ†ãŒé¸ã°ã‚Œã‚‹ç†ç”±ã‚’å¾¹åº•è§£èª¬",
        "ä»™å°ãƒ»å›½åˆ†ç”ºã§ãƒ¡ãƒ³ã‚ºã‚¨ã‚¹ãƒ†æ¢ã—ã«è¿·ã£ãŸã‚‰ï¼Ÿåœ°å…ƒæ°‘ãŒæœ¬æ°—ã§ãŠã™ã™ã‚ã™ã‚‹åº—èˆ—No.1ã€Œå…¨åŠ›ã‚¨ã‚¹ãƒ†ã€ã®é­…åŠ›ã¨ã¯",
        "åˆå¿ƒè€…å¿…è¦‹ï¼ä»™å°ã®ãƒ¡ãƒ³ã‚ºã‚¨ã‚¹ãƒ†é¸ã³ã§å¤±æ•—ã—ãªã„ãŸã‚ã®5ã¤ã®ãƒã‚¤ãƒ³ãƒˆã¨ã€ç­†è€…ãŒå…¨åŠ›ã‚¨ã‚¹ãƒ†ã‚’æ¿€æ¨ã—ã™ã‚‹ç†ç”±",
    ],
    "structure": (
        "# ã€2026å¹´æœ€æ–°ã€‘ä»™å°ã®ãƒ¡ãƒ³ã‚ºã‚¨ã‚¹ãƒ†äººæ°—ãƒ©ãƒ³ã‚­ãƒ³ã‚°TOP5ï¼å…¨åŠ›ã‚¨ã‚¹ãƒ†ãŒé¸ã°ã‚Œã‚‹ç†ç”±ã¨ã¯\n\n"
        "## ã¯ã˜ã‚ã«ï¼šä»™å°ã§å¿ƒã‚‚ä½“ã‚‚ç™’ã•ã‚Œã‚‹ã€æœ€é«˜ã®ãƒ¡ãƒ³ã‚ºã‚¨ã‚¹ãƒ†ä½“é¨“ã‚’ã—ã¾ã›ã‚“ã‹ï¼Ÿ\n"
        "ï¼ˆå°å…¥æ–‡ï¼‰\n\n"
        "## ä»™å°ãƒ¡ãƒ³ã‚ºã‚¨ã‚¹ãƒ†é¸ã³ã§å¤±æ•—ã—ãªã„ãŸã‚ã®3ã¤ã®ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ\n"
        "### 1. ã‚»ãƒ©ãƒ”ã‚¹ãƒˆã®è³ªã¨ç›¸æ€§\n"
        "### 2. æ–™é‡‘ä½“ç³»ã®æ˜ç¢ºã•\n"
        "### 3. åº—å†…ã®æ¸…æ½”æ„Ÿã¨ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼\n\n"
        "## ã€ç‹¬è‡ªèª¿æŸ»ã€‘ä»™å°ãƒ¡ãƒ³ã‚ºã‚¨ã‚¹ãƒ†ãŠã™ã™ã‚ãƒ©ãƒ³ã‚­ãƒ³ã‚°TOP5\n"
        "### ç¬¬5ä½ã€œç¬¬2ä½\n\n"
        "## ãã—ã¦ç¬¬1ä½ã¯â€¦åœ§å€’çš„ãªæº€è¶³åº¦ã‚’èª‡ã‚‹ã€Œå…¨åŠ›ã‚¨ã‚¹ãƒ†ã€ï¼\n"
        "### å…¨åŠ›ã‚¨ã‚¹ãƒ†ãŒä»™å°ã§é¸ã°ã‚Œç¶šã‘ã‚‹5ã¤ã®ç†ç”±\n"
        "#### ç†ç”±1ï¼šãƒã‚¤ãƒ¬ãƒ™ãƒ«ãªã‚»ãƒ©ãƒ”ã‚¹ãƒˆé™£\n"
        "#### ç†ç”±2ï¼šæ˜æœ—ä¼šè¨ˆã®æ–™é‡‘ã‚·ã‚¹ãƒ†ãƒ \n"
        "#### ç†ç”±3ï¼šå®Œå…¨å€‹å®¤ã®ç™’ã‚„ã—ç©ºé–“\n"
        "#### ç†ç”±4ï¼šæŠœç¾¤ã®ã‚¢ã‚¯ã‚»ã‚¹\n"
        "#### ç†ç”±5ï¼šæ„Ÿå‹•ã®å£ã‚³ãƒŸãƒ»ä½“é¨“è«‡\n\n"
        "## å…¨åŠ›ã‚¨ã‚¹ãƒ†ã®ã‚µãƒ¼ãƒ“ã‚¹è©³ç´°ã¨ã”äºˆç´„æ–¹æ³•\n"
        "## ã¾ã¨ã‚"
    ),
}

TEMPLATE_2_INFO = {
    "id": "howto",
    "title": "ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ2ï¼šãŠæ‚©ã¿è§£æ±ºå‹ãƒã‚¦ãƒ„ãƒ¼è¨˜äº‹",
    "emoji": "ğŸ’¡",
    "description": (
        "ã€Œãƒ¡ãƒ³ã‚ºã‚¨ã‚¹ãƒ† åˆã‚ã¦ã€ã€Œãƒ¡ãƒ³ã‚ºã‚¨ã‚¹ãƒ† é¸ã³æ–¹ã€ãªã©ã®æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§ä¸Šä½è¡¨ç¤ºã‚’ç‹™ã†è¨˜äº‹ã€‚\n"
        "ãŠåº—é¸ã³ã®å°‚é–€å®¶ã¨ã—ã¦å…¨åŠ›ã‚¨ã‚¹ãƒ†ã®ä¿¡é ¼æ€§ã‚’é«˜ã‚ã¾ã™ã€‚"
    ),
    "title_examples": [
        "ã€åˆå¿ƒè€…å‘ã‘ã€‘ãƒ¡ãƒ³ã‚ºã‚¨ã‚¹ãƒ†ã®é¸ã³æ–¹ã§å¤±æ•—ã—ãªã„7ã¤ã®ã‚³ãƒ„ï½œä»™å°ã®ãƒ—ãƒ­ãŒå¾¹åº•è§£èª¬",
        "ã€Œãƒ¡ãƒ³ã‚ºã‚¨ã‚¹ãƒ†ã£ã¦ä½•ã™ã‚‹ã®ï¼Ÿã€æ–™é‡‘ç›¸å ´ã‹ã‚‰ã‚µãƒ¼ãƒ“ã‚¹å†…å®¹ã¾ã§ã€ãƒ—ãƒ­ãŒæ•™ãˆã‚‹ãƒ¡ãƒ³ã‚ºã‚¨ã‚¹ãƒ†ã®åŸºæœ¬",
        "è‰¯ã„ã‚»ãƒ©ãƒ”ã‚¹ãƒˆã®è¦‹åˆ†ã‘æ–¹ã¨ã¯ï¼Ÿãƒ¡ãƒ³ã‚ºã‚¨ã‚¹ãƒ†ã®ãƒ—ãƒ­ãŒæ•™ãˆã‚‹ã€æœ€é«˜ã®ç™’ã‚„ã—ã‚’å¾—ã‚‹ãŸã‚ã®æŒ‡åãƒ†ã‚¯ãƒ‹ãƒƒã‚¯",
    ],
    "structure": (
        "# ã€åˆå¿ƒè€…å‘ã‘ã€‘ãƒ¡ãƒ³ã‚ºã‚¨ã‚¹ãƒ†ã®é¸ã³æ–¹ã§å¤±æ•—ã—ãªã„7ã¤ã®ã‚³ãƒ„ï½œä»™å°ã®ãƒ—ãƒ­ãŒå¾¹åº•è§£èª¬\n\n"
        "## ã¯ã˜ã‚ã«ï¼šåˆã‚ã¦ã®ãƒ¡ãƒ³ã‚ºã‚¨ã‚¹ãƒ†ã€ä¸å®‰ã§ã„ã£ã±ã„ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã‹ï¼Ÿ\n"
        "ï¼ˆå°å…¥æ–‡ï¼‰\n\n"
        "## ã‚³ãƒ„1ï¼šã¾ãšã¯è‡ªåˆ†ãŒæ±‚ã‚ã‚‹ã‚‚ã®ã‚’æ˜ç¢ºã«ã™ã‚‹\n"
        "## ã‚³ãƒ„2ï¼šåº—èˆ—ã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆåº—èˆ—å‹ï¼ãƒãƒ³ã‚·ãƒ§ãƒ³å‹ï¼‰ã‚’ãƒã‚§ãƒƒã‚¯\n"
        "## ã‚³ãƒ„3ï¼šå…¬å¼ã‚µã‚¤ãƒˆã§æ–™é‡‘ã¨ã‚³ãƒ¼ã‚¹å†…å®¹ã‚’ç¢ºèªã™ã‚‹\n"
        "## ã‚³ãƒ„4ï¼šã‚»ãƒ©ãƒ”ã‚¹ãƒˆã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’èª­ã¿è¾¼ã‚€\n"
        "## ã‚³ãƒ„5ï¼šå£ã‚³ãƒŸã‚„ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å†·é™ã«ãƒã‚§ãƒƒã‚¯ã™ã‚‹\n"
        "## ã‚³ãƒ„6ï¼šSNSï¼ˆXã‚„Instagramï¼‰ã§ãƒªã‚¢ãƒ«ãªæƒ…å ±ã‚’åé›†\n"
        "## ã‚³ãƒ„7ï¼šæœ€å¾Œã¯ç›´æ„Ÿï¼ä½“é¨“ã‚³ãƒ¼ã‚¹ã§è©¦ã—ã¦ã¿ã‚‹\n\n"
        "## è¿·ã£ãŸã‚‰ã“ã“ï¼ä»™å°ã§åˆå¿ƒè€…ãŒå®‰å¿ƒã—ã¦é€šãˆã‚‹ã€Œå…¨åŠ›ã‚¨ã‚¹ãƒ†ã€\n"
        "### ãªãœã€Œå…¨åŠ›ã‚¨ã‚¹ãƒ†ã€ã¯åˆå¿ƒè€…ã«ãŠã™ã™ã‚ãªã®ã‹ï¼Ÿ\n\n"
        "## ã¾ã¨ã‚ï¼šå‹‡æ°—ã‚’å‡ºã—ã¦ã€æ–°ã—ã„ç™’ã‚„ã—ã®æ‰‰ã‚’é–‹ã„ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ"
    ),
}

# â”€â”€â”€ å…¨åŠ›ã‚¨ã‚¹ãƒ† åº—èˆ—æƒ…å ±ï¼ˆAIç”Ÿæˆæ™‚ã«å‚ç…§ï¼‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ZENRYOKU_ESTHE_INFO = """
ã€åº—èˆ—åã€‘å…¨åŠ›ã‚¨ã‚¹ãƒ†
ã€ã‚¨ãƒªã‚¢ã€‘ä»™å°ï¼ˆå®®åŸçœŒä»™å°å¸‚ï¼‰
ã€æœ€å¯„ã‚Šé§…ã€‘ä»™å°é§…ã‹ã‚‰å¾’æ­©åœå†…
ã€æ¥­æ…‹ã€‘ãƒ¡ãƒ³ã‚ºã‚¨ã‚¹ãƒ†ï¼ˆåº—èˆ—å‹ï¼‰
ã€ç‰¹å¾´ã€‘
- å³ã—ã„ç ”ä¿®ã‚’ã‚¯ãƒªã‚¢ã—ãŸãƒã‚¤ãƒ¬ãƒ™ãƒ«ãªã‚»ãƒ©ãƒ”ã‚¹ãƒˆé™£
- æ˜æœ—ä¼šè¨ˆã§è¿½åŠ æ–™é‡‘ä¸€åˆ‡ãªã—ã®æ–™é‡‘ã‚·ã‚¹ãƒ†ãƒ 
- å®Œå…¨å€‹å®¤ã§ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã‚‚ä¸‡å…¨ã€é«˜ç´šæ„Ÿã‚ãµã‚Œã‚‹ç™’ã‚„ã—ç©ºé–“
- ä¸å¯§ãªã‚«ã‚¦ãƒ³ã‚»ãƒªãƒ³ã‚°ã§ãŠå®¢æ§˜ä¸€äººã²ã¨ã‚Šã«åˆã‚ã›ãŸæ–½è¡“
- å…¬å¼ã‚µã‚¤ãƒˆã¨SNSã§ã‚»ãƒ©ãƒ”ã‚¹ãƒˆã®æƒ…å ±ã‚’æ¯æ—¥æ›´æ–°
- åœ§å€’çš„ãªãƒªãƒ”ãƒ¼ãƒˆç‡ã‚’èª‡ã‚‹
ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã€‘ä»™å°ã‚¨ãƒªã‚¢ã§ç™’ã‚„ã—ã‚’æ±‚ã‚ã‚‹ç”·æ€§ï¼ˆåˆå¿ƒè€…ã€œãƒªãƒ”ãƒ¼ã‚¿ãƒ¼ï¼‰
"""

# â”€â”€â”€ SEOãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

SEO_CHECKLIST = """
ğŸ“‹ ã€SEOãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã€‘
â–¡ ã‚¿ã‚¤ãƒˆãƒ«ã«ã€Œä»™å°ã€ã€Œãƒ¡ãƒ³ã‚ºã‚¨ã‚¹ãƒ†ã€ã¨å¯¾ç­–ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥ã‚ŒãŸã‹ï¼Ÿ
â–¡ ã‚¿ã‚¤ãƒˆãƒ«ã«å¹´å·ã‚„æ•°å­—ã‚’å…¥ã‚Œã¦å…·ä½“æ€§ãƒ»é®®åº¦ã‚’å‡ºã—ãŸã‹ï¼Ÿ
â–¡ H1è¦‹å‡ºã—ã¯ã‚¿ã‚¤ãƒˆãƒ«ã¨ã»ã¼åŒã˜å†…å®¹ã‹ï¼Ÿ
â–¡ H2ã€H3è¦‹å‡ºã—ã«å¯¾ç­–ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’è‡ªç„¶ã«å«ã‚ã¦ã„ã‚‹ã‹ï¼Ÿ
â–¡ å°å…¥æ–‡ã§èª­è€…ã®æ‚©ã¿ã«å…±æ„Ÿã—ã€èª­ã‚€ãƒ¡ãƒªãƒƒãƒˆã‚’ä¼ãˆã¦ã„ã‚‹ã‹ï¼Ÿ
â–¡ ç”»åƒã«altå±æ€§ï¼ˆç”»åƒã®èª¬æ˜æ–‡ï¼‰ã‚’è¨­å®šã—ãŸã‹ï¼Ÿ
â–¡ CTAï¼ˆäºˆç´„ãƒœã‚¿ãƒ³ã€é›»è©±ç•ªå·ï¼‰ã¯ç›®ç«‹ã¤ã‚ˆã†ã«é…ç½®ã—ãŸã‹ï¼Ÿ
â–¡ é–¢é€£ã™ã‚‹å†…éƒ¨è¨˜äº‹ï¼ˆãƒ–ãƒ­ã‚°ãªã©ï¼‰ã¸ã®ãƒªãƒ³ã‚¯ã‚’è¨­ç½®ã—ãŸã‹ï¼Ÿ
â–¡ èª¤å­—è„±å­—ã¯ãªã„ã‹ï¼Ÿï¼ˆå…¬é–‹å‰ã«éŸ³èª­ã—ã¦ãƒã‚§ãƒƒã‚¯ï¼‰
"""


# â”€â”€â”€ OpenAI APIã«ã‚ˆã‚‹è¨˜äº‹ç”Ÿæˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

def _get_system_prompt_ranking() -> str:
    """ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ1ï¼ˆãƒ©ãƒ³ã‚­ãƒ³ã‚°ç´¹ä»‹é¢¨ï¼‰ã®ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ"""
    return f"""ã‚ãªãŸã¯ä»™å°ã®ãƒ¡ãƒ³ã‚ºã‚¨ã‚¹ãƒ†ã€Œå…¨åŠ›ã‚¨ã‚¹ãƒ†ã€ã®SEOãƒ©ã‚¤ã‚¿ãƒ¼ã§ã™ã€‚
ä»¥ä¸‹ã®åº—èˆ—æƒ…å ±ã‚’åŸºã«ã€ã€Œä»™å° ãƒ¡ãƒ³ã‚ºã‚¨ã‚¹ãƒ† ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã€ã§æ¤œç´¢ä¸Šä½ã‚’ç‹™ã†SEOè¨˜äº‹ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

{ZENRYOKU_ESTHE_INFO}

ã€è¨˜äº‹ã®æ–¹é‡ã€‘
- ãƒ©ãƒ³ã‚­ãƒ³ã‚°å½¢å¼ã§ä»™å°ã®ãƒ¡ãƒ³ã‚ºã‚¨ã‚¹ãƒ†TOP5ã‚’ç´¹ä»‹ã™ã‚‹ä½“è£
- ç¬¬1ä½ã¨ã—ã¦ã€Œå…¨åŠ›ã‚¨ã‚¹ãƒ†ã€ã‚’ç´¹ä»‹ã—ã€é¸ã°ã‚Œã‚‹ç†ç”±ã‚’5ã¤è©³ã—ãè§£èª¬
- ç¬¬2ä½ã€œç¬¬5ä½ã¯æ¶ç©ºã®åº—èˆ—åï¼ˆã€‡ã€‡ã‚¨ã‚¹ãƒ†ã€â–³â–³ã‚µãƒ­ãƒ³ç­‰ï¼‰ã§ç°¡æ½”ã«ç´¹ä»‹
- èª­è€…ã®æ‚©ã¿ã«å…±æ„Ÿã™ã‚‹å°å…¥æ–‡ã‹ã‚‰å§‹ã‚ã‚‹
- ãŠåº—é¸ã³ã®ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã‚’å«ã‚ã‚‹
- æœ€å¾Œã«CTAï¼ˆäºˆç´„ã¸ã®è¡Œå‹•å–šèµ·ï¼‰ã‚’é…ç½®
- æ–‡ä½“ã¯ä¸å¯§ã§è¦ªã—ã¿ã‚„ã™ãã€SEOã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’è‡ªç„¶ã«ç››ã‚Šè¾¼ã‚€
- 5000æ–‡å­—ä»¥ä¸Šã®é•·æ–‡ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç›®æŒ‡ã™
- Markdownå½¢å¼ã§å‡ºåŠ›ï¼ˆH1, H2, H3ã‚’é©åˆ‡ã«ä½¿ç”¨ï¼‰"""


def _get_system_prompt_howto() -> str:
    """ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ2ï¼ˆãŠæ‚©ã¿è§£æ±ºå‹ãƒã‚¦ãƒ„ãƒ¼ï¼‰ã®ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ"""
    return f"""ã‚ãªãŸã¯ä»™å°ã®ãƒ¡ãƒ³ã‚ºã‚¨ã‚¹ãƒ†ã€Œå…¨åŠ›ã‚¨ã‚¹ãƒ†ã€ã®SEOãƒ©ã‚¤ã‚¿ãƒ¼ã§ã™ã€‚
ä»¥ä¸‹ã®åº—èˆ—æƒ…å ±ã‚’åŸºã«ã€ã€Œãƒ¡ãƒ³ã‚ºã‚¨ã‚¹ãƒ† åˆã‚ã¦ã€ã€Œãƒ¡ãƒ³ã‚ºã‚¨ã‚¹ãƒ† é¸ã³æ–¹ã€ã§æ¤œç´¢ä¸Šä½ã‚’ç‹™ã†SEOè¨˜äº‹ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

{ZENRYOKU_ESTHE_INFO}

ã€è¨˜äº‹ã®æ–¹é‡ã€‘
- ãƒ¡ãƒ³ã‚ºã‚¨ã‚¹ãƒ†åˆå¿ƒè€…å‘ã‘ã«ã€ãŠåº—é¸ã³ã§å¤±æ•—ã—ãªã„7ã¤ã®ã‚³ãƒ„ã‚’è§£èª¬
- å„ã‚³ãƒ„ã‚’å…·ä½“çš„ã‹ã¤å®Ÿè·µçš„ã«èª¬æ˜
- è¨˜äº‹ã®å¾ŒåŠã§ã€Œå…¨åŠ›ã‚¨ã‚¹ãƒ†ã€ã‚’åˆå¿ƒè€…ã«ãŠã™ã™ã‚ã®åº—èˆ—ã¨ã—ã¦è‡ªç„¶ã«ç´¹ä»‹
- å…¨åŠ›ã‚¨ã‚¹ãƒ†ãŒåˆå¿ƒè€…ã«å®‰å¿ƒãªç†ç”±ã‚’3ã¤æŒ™ã’ã¦è§£èª¬
- èª­è€…ã®ä¸å®‰ã«å¯„ã‚Šæ·»ã†å°å…¥æ–‡ã‹ã‚‰å§‹ã‚ã‚‹
- æœ€å¾Œã«CTAï¼ˆäºˆç´„ã¸ã®è¡Œå‹•å–šèµ·ï¼‰ã‚’é…ç½®
- æ–‡ä½“ã¯ä¸å¯§ã§è¦ªã—ã¿ã‚„ã™ãã€å°‚é–€å®¶ã¨ã—ã¦ã®ä¿¡é ¼æ„Ÿã‚’å‡ºã™
- 5000æ–‡å­—ä»¥ä¸Šã®é•·æ–‡ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç›®æŒ‡ã™
- Markdownå½¢å¼ã§å‡ºåŠ›ï¼ˆH1, H2, H3ã‚’é©åˆ‡ã«ä½¿ç”¨ï¼‰"""


async def generate_seo_article(template_type: str, custom_keyword: str = "") -> str:
    """
    OpenAI APIã‚’ä½¿ã£ã¦SEOè¨˜äº‹ãƒ‰ãƒ©ãƒ•ãƒˆã‚’ç”Ÿæˆã™ã‚‹ã€‚

    Args:
        template_type: "ranking" or "howto"
        custom_keyword: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæŒ‡å®šã—ãŸè¿½åŠ ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

    Returns:
        ç”Ÿæˆã•ã‚ŒãŸè¨˜äº‹ãƒ†ã‚­ã‚¹ãƒˆ
    """
    try:
        import openai
        client = openai.OpenAI()

        if template_type == "ranking":
            system_prompt = _get_system_prompt_ranking()
            user_prompt = "ä»™å°ã®ãƒ¡ãƒ³ã‚ºã‚¨ã‚¹ãƒ†äººæ°—ãƒ©ãƒ³ã‚­ãƒ³ã‚°TOP5ã®è¨˜äº‹ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚å…¨åŠ›ã‚¨ã‚¹ãƒ†ã‚’ç¬¬1ä½ã¨ã—ã¦ç´¹ä»‹ã—ã¦ãã ã•ã„ã€‚"
        else:
            system_prompt = _get_system_prompt_howto()
            user_prompt = "ãƒ¡ãƒ³ã‚ºã‚¨ã‚¹ãƒ†ã®é¸ã³æ–¹ã§å¤±æ•—ã—ãªã„7ã¤ã®ã‚³ãƒ„ã®è¨˜äº‹ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚å…¨åŠ›ã‚¨ã‚¹ãƒ†ã‚’åˆå¿ƒè€…ã«ãŠã™ã™ã‚ã®åº—èˆ—ã¨ã—ã¦ç´¹ä»‹ã—ã¦ãã ã•ã„ã€‚"

        if custom_keyword:
            user_prompt += f"\n\nè¿½åŠ ã§æ„è­˜ã™ã‚‹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: {custom_keyword}"

        response = client.chat.completions.create(
            model="gpt-4.1-mini",
            messages=[
                {"role": "system", "content": system_prompt},
                {"role": "user", "content": user_prompt},
            ],
            max_tokens=4000,
            temperature=0.7,
        )

        article = response.choices[0].message.content
        return article

    except Exception as e:
        logger.error(f"SEOè¨˜äº‹ç”Ÿæˆã‚¨ãƒ©ãƒ¼: {e}")
        raise


def get_template_preview(template_type: str) -> str:
    """ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æƒ…å ±ã‚’è¿”ã™"""
    if template_type == "ranking":
        info = TEMPLATE_1_INFO
    else:
        info = TEMPLATE_2_INFO

    title_list = "\n".join(f"  â€¢ {t}" for t in info["title_examples"])

    return (
        f"{info['emoji']} ã€{info['title']}ã€‘\n\n"
        f"{info['description']}\n\n"
        f"ğŸ“ ã‚¿ã‚¤ãƒˆãƒ«æ¡ˆ:\n{title_list}\n\n"
        f"ğŸ“ è¨˜äº‹æ§‹æˆ:\n{info['structure']}"
    )
